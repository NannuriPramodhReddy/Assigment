import React, { useState } from 'react';
import { scanImage } from '../services/api';
import styles from './ContainerImageList.module.css';

const ContainerImageList = ({ images }) => {
    const [scanningStates, setScanningStates] = useState({});

    const handleScanImage = async (imageId) => {
        setScanningStates(prev => ({ ...prev, [imageId]: true }));
        try {
            await scanImage(imageId);
            alert('Scan initiated for image: ' + imageId);
        } catch (error) {
            console.error('Error scanning image:', error);
            alert('Scan failed');
        }
        setScanningStates(prev => ({ ...prev, [imageId]: false }));
    };

    return (
        <div className={styles.container}>
            <h2 className={styles.header}>Container Images</h2>
            <ul className={styles.imageList}>
                {images.map(image => (
                    <li key={image.id} className={styles.imageItem}>
                        <span className={styles.imageName}>
                            {image.imageName}:{image.imageTag}
                        </span>
                        <button
                            className={styles.scanButton}
                            onClick={() => handleScanImage(image.id)}
                            disabled={scanningStates[image.id]}
                        >
                            {scanningStates[image.id] ? 'Scanning...' : 'Scan Image'}
                        </button>
                    </li>
                ))}
            </ul>
        </div>
    );
};

export default ContainerImageList;